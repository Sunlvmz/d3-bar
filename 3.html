<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>

<div class="someclass">
    <div id="bar-chart">
    </div>
</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>

<script>
  const tip = d3.tip().attr('class', 'd3-tip').html(d => d);

  const chartdata = [
    40, 60, 80, 100, 70, 120,
    100, 60, 70, 150, 120, 140,
    80, 100, 70, 120, 100, 60, 70
  ];

  const margin = { top: 60, right: 20, bottom: 30, left: 35 };

  const height = 300;
  const width = 720;
  const chartHeight = height - margin.top - margin.bottom;
  const chartWidth = width - margin.left - margin.right;

  // y轴比例尺
  const yScale = d3.scaleLinear()
    .domain([0, d3.max(chartdata)]) // .domain(d3.extent(chartdata))
    .range([0, chartHeight]);

  // x轴比例尺
  const xScale = d3.scaleBand() // 创建序数段比例尺
    .domain(d3.range(0, chartdata.length))
    .padding(0.5)
    .range([0, chartWidth]);

  // 颜色比例尺
  const colors = d3.scaleLinear()
    .domain([0, chartdata.length * .33, chartdata.length * .66, chartdata.length])
    .range(['#00A1CB', '#D0D102', '#F18D05', '#D70060']);

  let dynamicColor;

  // 1. 添加svg
  const svg = d3.select('#bar-chart').append('svg')
    .attr('width', width)
    .attr('height', height)
    .style('background', '#67CDDC')
    .call(tip);

  // 2. 添加柱状图容器g
  const chart = svg.append('g')
      .attr('transform', `translate(${margin.left}, -${margin.bottom})`)
      .selectAll('rect').data(chartdata)
      .enter().append('rect')
      .attr('width', xScale.bandwidth())
      .attr('x', (data, i) => xScale(i))
  // Starting position prior to transition
  .attr('height', 0)
    .attr('y', height)
    .style('fill', (data, i) => colors(i))
  .style('stroke', d3.color('#00A9E0').darker(.6))
    .style('stroke-width', 2)
    .on('mouseover', data => {
    const { target } = d3.event;
  dynamicColor = d3.color(target.style.fill);
  d3.select(target).style('fill', dynamicColor.brighter(1.5))
  })
  .on('mouseout', data => {
    const { target } = d3.event;
  d3.select(target).style('fill', dynamicColor);
  });

  chart.transition()
    .attr('height', yScale)
    .attr('y', data => height - yScale(data))
  .delay((data, i) => i * 20)
  .duration(650)
    .ease(d3.easeSinIn);



  const xAxis = d3.axisBottom().scale(xScale);

  svg.append('g')
    .attr('transform', `translate(${margin.left}, ${height - margin.bottom})`)
    .call(xAxis);

  const yAxisScale = d3.scaleLinear()
    .domain([0, d3.max(chartdata)])
    .range([chartHeight, 0]);

  const yAxis = d3.axisLeft().scale(yAxisScale);

  svg.append('g')
    .attr('transform', `translate(${margin.left}, ${margin.top})`)
    .call(yAxis)
    .append('text')
    .attr('transform', 'rotate(-90)')
    .attr('y', 20)
    .style('font-family', 'Calibri')
    .style('font-size', 20)
    .style('stroke', 'white')
    .style('stroke-width', 0.2)
    .style('fill', 'white')
    .text('chartdata');

  svg.append('text')
    .attr('x', width / 2)
    .attr('y', margin.top / 2)
    .attr('text-anchor', 'middle')
    .style('font-family', 'Calibri')
    .style('font-size', 30)
    .style('fill', 'white')
    .text('Title');
</script>
</body>
</html>